#! .desc:
# Mangle and assert a path in a specified way
#! .params:
# <$1> - options(
#     '-assert' - assert dir/file
#     '-join' - join the two paths
#     '-join-assert' - join the two paths and assert dir/file
#     .
# )
# <"$2"> - absolute path
# ["$3"] - join path
# [$4] - type(
#     '-nout' - no output
#     .
# )
#! .gives:
# (0) <"$_path"> - string;
#                  [modified <$2>]
#! .rc:
# (0) [modified <$2>]
# (255) bad input
#.
path_spec() {
    case "$2" in
        '/'*) : ;;
        *) return 255 ;;
    esac

    case "$1" in
        '-join' | '-join-assert')
            { [ "$3" ] && [ "$3" != '-nout' ]; } || return 255
        ;;
    esac

    while :; do case "$2" in
        *'///'*)
            return 255
        ;;
        *'//'*)
            set -- "$1" "${2%'//'*}/${2#*'//'}" "$3" "$4"
        ;;
        *)
            break
        ;;
    esac done

    case "$1" in
        '-join' | '-join-assert')
            while :; do case "$3" in
                *'///'*)
                    return 255
                ;;
                *'//'*)
                    set -- "$1" "$2" "${3%'//'*}/${3#*'//'}" "$4"
                ;;
                *)
                    break
                ;;
            esac done

            case "$2" in
                *'/') set -- "$1" "${2%?}" "$3" "$4" ;;
            esac

            case "$3" in
                '/'*) set -- "$1" "$2" "${3#?}" "$4" ;;
            esac
        ;;
    esac

    case "$1" in
        '-assert')
            case "$2" in
                *'/') set -- "$1" "${2%?}" "$3" "$4" ;;
            esac

            _path="$2"
        ;;
        '-join')
            _path="$2/$3"
        ;;
        '-join-assert')
            case "$3" in
                *'/') set -- "$1" "$2" "${3%?}" "$4" ;;
            esac

            _path="$2/$3"
        ;;
    esac

    case "$1" in
        '-assert' | '-join-assert')
            if [ -d "$_path" ]; then
                _path="$_path/"
            fi
        ;;
    esac

    case "$4$3" in
        '-nout'*) : ;;
        *) printf "%s" "$_path" ;;
    esac
}
