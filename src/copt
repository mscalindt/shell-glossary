#! .desc:
# Match `-`-delimited short/long option with a mandatory option argument
#! .params (<3+>):
# <[$1]> - option
# <[$2]> - option argument
# [$3] - -* (short)
# [$4] - --* (long)
#! .gives.var:
# (0) <opt_arg> - string;
#                 option argument
# (0) <opt_shift> - integer;
#                   shift count for option
#! .rc:
# (0) true
# (1) false
#! .ec:
# (2) bad option argument specification
# (255) input error
#.
copt() {
    [ "$#" -ge 3 ] || exit 255

    # -> Assert $1 is a `-`-delimited short/long option;
    # -> Assert $3/$4 (whichever applies) is a `-`-delimited short/long option;
    # -> Assert (set) the relevant positional parameter is third in position.
    case "$1" in
        '--'*)
            [ "${#1}" -gt 2 ] || return 1

            case "$4" in
                '--'*)
                    [ "${#4}" -gt 2 ] || exit 255

                    set -- "$1" "$2" "$4"
                ;;
                *)
                    [ ! "$4" ] || exit 255

                    case "$3" in
                        '--'*) [ "${#3}" -gt 2 ] || exit 255 ;;
                        '-'*) return 1 ;;
                        *) exit 255 ;;
                    esac
                ;;
            esac
        ;;
        '-'*)
            [ "${#1}" -gt 1 ] || return 1

            case "$3" in
                '--'*) return 1 ;;
                '-'*) [ "${#3}" = 2 ] || exit 255 ;;
                *) exit 255 ;;
            esac
        ;;
        *)
            return 1
        ;;
    esac

    # Assert $1 fully matches $3; $2 is presumably the option argument.
    case "$1" in
        "$3")
            if [ ! "$2" ]; then
                printf "%s: Option '%s' requires an argument.\n" \
                    "${0##*/}" "$1" >&2
                printf "%s: Try '%s --help' for more information.\n" \
                    "${0##*/}" "${0##*/}" >&2

                exit 2
            fi

            opt_arg="$2"
            opt_shift=2

            return 0
        ;;
    esac

    # Assert $1 matches $3 with an argument.
    case "$1" in
        '--'*)
            case "$1" in
                "$3"'=')
                    printf "%s: Invalid argument specification for: '%s'\n" \
                        "${0##*/}" "$1" >&2
                    printf "%s: Try '%s --help' for more information.\n" \
                        "${0##*/}" "${0##*/}" >&2

                    exit 2
                ;;
                "$3"'='*)
                    opt_arg="${1#"$3"=}"
                    opt_shift=1

                    return 0
                ;;
            esac
        '-'*)
            case "$1" in
                "$3"*)
                    opt_arg="${1#"$3"}"
                    opt_shift=1

                    return 0
                ;;
            esac
        ;;
    esac

    return 1
}
